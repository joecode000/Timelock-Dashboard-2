<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  <title>Bitcoin Timelock Vault Dashboard</title>

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, sans-serif;
      background: radial-gradient(circle at top, #141627 0, #050711 60%);
      color: #f5f5f7;
    }

    .dashboard {
      max-width: 960px;
      margin: 0 auto;
      padding: 1.5rem 1rem 3rem;
    }

    .top-header {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .title-block h1 {
      margin: 0;
      font-size: 1.6rem;
    }

    .title-block p {
      margin: 0.2rem 0 0;
      opacity: 0.8;
      font-size: 0.9rem;
    }

    .market-strip {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .strip-item {
      flex: 1 1 180px;
      padding: 0.7rem 0.9rem;
      border-radius: 12px;
      background: rgba(10, 12, 26, 0.95);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }

    .strip-item .label {
      font-size: 0.8rem;
      opacity: 0.75;
      margin-bottom: 0.2rem;
    }

    .strip-item .value {
      font-size: 1rem;
      font-weight: 600;
    }

    .card {
      border-radius: 14px;
      background: rgba(8, 10, 22, 0.98);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.55);
      padding: 1rem 1.25rem;
      margin-bottom: 1.25rem;
    }

    .dca-mini h2 {
      margin: 0 0 0.6rem;
      font-size: 1.1rem;
    }

    .metric-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9rem;
      margin: 0.25rem 0;
      gap: 0.75rem;
    }

    .metric-label {
      opacity: 0.8;
    }

    .metric-value {
      font-weight: 600;
      text-align: right;
      white-space: nowrap;
    }

    .vault-section h2 {
      margin: 0 0 0.5rem;
      font-size: 1.1rem;
    }

    .vault-card {
      margin-top: 0.8rem;
      padding: 0.85rem 1rem 1rem;
      border-radius: 14px;
      background: rgba(6, 8, 18, 0.98);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
    }

    .vault-header {
      margin-bottom: 0.4rem;
    }

    .vault-title {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .vault-address {
      font-size: 0.75rem;
      opacity: 0.8;
      word-break: break-all;
      margin-top: 0.1rem;
    }

    .timelock-row {
      font-size: 0.82rem;
      opacity: 0.9;
      margin: 0.35rem 0 0.5rem;
    }

    .vault-dashboard .metric-row {
      font-size: 0.85rem;
    }

    .pl-positive {
      color: #34e39a;
    }

    .pl-negative {
      color: #ff6b6b;
    }

    .vault-notes {
      margin-top: 0.7rem;
      padding: 0.7rem;
      background: rgba(255, 255, 255, 0.04);
      border-radius: 10px;
      font-size: 0.85rem;
    }

    .vault-notes textarea {
      width: 100%;
      min-height: 60px;
      margin-top: 0.35rem;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-radius: 8px;
      padding: 0.45rem;
      color: #fff;
      resize: vertical;
      font-size: 0.85rem;
      font-family: inherit;
    }

    @media (max-width: 640px) {
      .dashboard {
        padding: 1rem 0.75rem 2.5rem;
      }
    }
  </style>
</head>
<body>
  <main class="dashboard">
    <header class="top-header">
      <div class="title-block">
        <h1>‚è±Ô∏è Bitcoin Timelock Vaults</h1>
        <p>On-chain DCA & Timelock Monitor</p>
      </div>

      <div class="market-strip">
        <div class="strip-item">
          <div class="label">‚Çø Bitcoin Price</div>
          <div class="value" id="btc-price">Loading‚Ä¶</div>
        </div>
        <div class="strip-item">
          <div class="label">üìä Bitcoin Market Cap</div>
          <div class="value" id="btc-mcap">Loading‚Ä¶</div>
        </div>
        <div class="strip-item">
          <div class="label">ü•á Gold Market Cap</div>
          <div class="value" id="gold-mcap">$14.2T (static)</div>
        </div>
      </div>
    </header>

    <!-- Global mini DCA dashboard -->
    <section id="dca-mini-dashboard" class="card dca-mini">
      <h2>üìä DCA Snapshot</h2>
      <div class="metric-row">
        <span class="metric-label">üí∏ Total invested</span>
        <span class="metric-value" id="mini-total-invested">$0.00</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">ü™ô BTC accumulated</span>
        <span class="metric-value" id="mini-btc-accumulated">0.00000000 BTC</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">‚ö° Sats accumulated</span>
        <span class="metric-value" id="mini-sats-accumulated">0 sats</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">üéØ Blended average</span>
        <span class="metric-value" id="mini-blended-avg">$0.00 / BTC</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">üìà Current value</span>
        <span class="metric-value" id="mini-current-value">$0.00</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">üíπ P/L & ROI</span>
        <span class="metric-value" id="mini-pl-roi">+$0.00 (0.00%)</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">‚è≥ Time in market</span>
        <span class="metric-value" id="mini-time-in-market">0 days</span>
      </div>
    </section>

    <!-- Vault breakdown -->
    <section class="vault-section">
      <h2>üß± Vault Breakdown</h2>
      <div id="vault-list"></div>
    </section>
  </main>

  <script>
    const MS_PER_DAY = 1000 * 60 * 60 * 24;

    // Static estimate for total above-ground gold x price
    const GOLD_MARKET_CAP = 14_200_000_000_000; // ~$14.2T

    // Timelock vaults
    const vaults = [
      {
        label: "2022 ‚Äì Vault 1",
        address: "3KMrnQymf9gfu1QzYTepCGy8rv4Je2nHby",
        investedUsd: 500.0,
        btcAmount: 0.01299249,
        startDate: "2022-03-12", // üîê lock date
        unlockDate: null,        // no expiration shown for this vault
        notes: "üéØ First base vault started March 12, 2022."
      },

      // Future timelock vault placeholders ‚Äì adjust amounts & notes as you fund them
      {
        label: "2026-01-01 ‚Äì Timelock Vault",
        address: "3ECBoJHeYwz4qDdovgHhME3Une89Zw63Ah",
        investedUsd: 0.0,
        btcAmount: 0.0,
        startDate: "2026-01-01",
        unlockDate: "2026-01-01T12:00:00Z",
        notes: "üîê Placeholder for 1 Jan 2026 timelock."
      },
      {
        label: "2026-04-01 ‚Äì Timelock Vault",
        address: "346AQ1Gz8AP9rmzupgj36vsuecjyNdtqt4",
        investedUsd: 0.0,
        btcAmount: 0.0,
        startDate: "2026-04-01",
        unlockDate: "2026-04-01T12:00:00Z",
        notes: "üîê Placeholder for 1 Apr 2026 timelock."
      }
    ];

    function saveVaultNotes(address, text) {
      localStorage.setItem(`vault-notes-${address}`, text);
    }

    function getStoredNotes(address) {
      return localStorage.getItem(`vault-notes-${address}`) || "";
    }

    function formatUsd(num) {
      return `$${num.toLocaleString(undefined, {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      })}`;
    }

    function formatNumber(num) {
      return num.toLocaleString();
    }

    function computeVaultMetrics(vault, btcPrice) {
      const currentValue = vault.btcAmount * btcPrice;
      const pl = currentValue - vault.investedUsd;
      const roiPct =
        vault.investedUsd > 0 ? (pl / vault.investedUsd) * 100 : 0;
      const blendedAverage =
        vault.btcAmount > 0 ? vault.investedUsd / vault.btcAmount : 0;
      const sats = Math.round(vault.btcAmount * 100_000_000);

      let daysInMarket = 0;
      if (vault.startDate) {
        const start = new Date(vault.startDate);
        const now = new Date();
        daysInMarket = Math.floor((now - start) / MS_PER_DAY);
      }

      return {
        currentValue,
        pl,
        roiPct,
        blendedAverage,
        sats,
        daysInMarket
      };
    }

    function computeGlobalMetrics(btcPrice) {
      let totalInvested = 0;
      let totalBtc = 0;
      let earliestDate = null;

      vaults.forEach((vault) => {
        totalInvested += vault.investedUsd;
        totalBtc += vault.btcAmount;

        if (vault.startDate) {
          const d = new Date(vault.startDate);
          if (!earliestDate || d < earliestDate) earliestDate = d;
        }
      });

      const totalSats = Math.round(totalBtc * 100_000_000);
      const currentValue = totalBtc * btcPrice;
      const pl = currentValue - totalInvested;
      const roiPct =
        totalInvested > 0 ? (pl / totalInvested) * 100 : 0;
      const blendedAverage =
        totalBtc > 0 ? totalInvested / totalBtc : 0;

      let daysInMarket = 0;
      if (earliestDate) {
        const now = new Date();
        daysInMarket = Math.floor((now - earliestDate) / MS_PER_DAY);
      }

      return {
        totalInvested,
        totalBtc,
        totalSats,
        currentValue,
        pl,
        roiPct,
        blendedAverage,
        daysInMarket
      };
    }

    function renderGlobalMiniDashboard(btcPrice) {
      const g = computeGlobalMetrics(btcPrice);

      document.getElementById("mini-total-invested").textContent =
        formatUsd(g.totalInvested);
      document.getElementById("mini-btc-accumulated").textContent =
        `${g.totalBtc.toFixed(8)} BTC`;
      document.getElementById("mini-sats-accumulated").textContent =
        `${formatNumber(g.totalSats)} sats`;
      document.getElementById("mini-blended-avg").textContent =
        `${formatUsd(g.blendedAverage)} / BTC`;
      document.getElementById("mini-current-value").textContent =
        formatUsd(g.currentValue);

      const plRoiEl = document.getElementById("mini-pl-roi");
      const sign = g.pl >= 0 ? "+" : "";
      plRoiEl.textContent =
        `${sign}${formatUsd(g.pl)} (${g.roiPct.toFixed(2)}%)`;
      plRoiEl.classList.toggle("pl-positive", g.pl >= 0);
      plRoiEl.classList.toggle("pl-negative", g.pl < 0);

      document.getElementById("mini-time-in-market").textContent =
        `${g.daysInMarket} days`;
    }

    function renderVaults(btcPrice) {
      const container = document.getElementById("vault-list");
      container.innerHTML = "";

      vaults.forEach((vault) => {
        const m = computeVaultMetrics(vault, btcPrice);

        const start = vault.startDate ? new Date(vault.startDate) : null;
        const unlock = vault.unlockDate ? new Date(vault.unlockDate) : null;

        const startLabel = start
          ? start.toLocaleDateString(undefined, {
              year: "numeric",
              month: "short",
              day: "numeric"
            })
          : "N/A";

        let timelineText = "";
        if (start && unlock) {
          const unlockLabel = unlock.toLocaleDateString(undefined, {
            year: "numeric",
            month: "short",
            day: "numeric"
          });
          timelineText = `üîê ${startLabel} ‚Üí ${unlockLabel} (‚è≥ ${m.daysInMarket} days)`;
        } else if (start && !unlock) {
          timelineText = `üîê ${startLabel} (‚è≥ ${m.daysInMarket} days)`;
        } else {
          timelineText = "üîê N/A";
        }

        const existingNotes =
          getStoredNotes(vault.address) || vault.notes || "";

        const html = `
          <div class="vault-card">
            <div class="vault-header">
              <div class="vault-title">üß± ${vault.label}</div>
              <div class="vault-address">üîë ${vault.address}</div>
            </div>

            <div class="timelock-row">
              ${timelineText}
            </div>

            <div class="vault-dashboard">
              <div class="metric-row">
                <span class="metric-label">üí∏ Total invested</span>
                <span class="metric-value">${formatUsd(
                  vault.investedUsd
                )}</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">ü™ô BTC accumulated</span>
                <span class="metric-value">${vault.btcAmount.toFixed(
                  8
                )} BTC</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">‚ö° Sats accumulated</span>
                <span class="metric-value">${formatNumber(
                  m.sats
                )} sats</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">üéØ Blended average</span>
                <span class="metric-value">${formatUsd(
                  m.blendedAverage
                )} / BTC</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">üìà Current value</span>
                <span class="metric-value">${formatUsd(
                  m.currentValue
                )}</span>
              </div>
              <div class="metric-row">
                <span class="metric-label">üíπ P/L & ROI</span>
                <span class="metric-value ${
                  m.pl >= 0 ? "pl-positive" : "pl-negative"
                }">
                  ${(m.pl >= 0 ? "+" : "") + formatUsd(m.pl)}
                  (${m.roiPct.toFixed(2)}%)
                </span>
              </div>
              <div class="metric-row">
                <span class="metric-label">‚è≥ Time in market</span>
                <span class="metric-value">${m.daysInMarket} days</span>
              </div>
            </div>

            <div class="vault-notes">
              <strong>üìù Notes</strong>
              <textarea
                placeholder="Add notes for this vault‚Ä¶"
                oninput="saveVaultNotes('${vault.address}', this.value)"
              >${existingNotes}</textarea>
            </div>
          </div>
        `;

        container.insertAdjacentHTML("beforeend", html);
      });
    }

    async function loadBitcoinData() {
      try {
        const res = await fetch(
          "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_market_cap=true"
        );
        const data = await res.json();
        const price = data.bitcoin.usd;
        const mcap = data.bitcoin.usd_market_cap;

        const priceEl = document.getElementById("btc-price");
        const mcapEl = document.getElementById("btc-mcap");
        const goldEl = document.getElementById("gold-mcap");

        if (priceEl) {
          priceEl.textContent = `$${price.toLocaleString()}`;
        }
        if (mcapEl) {
          mcapEl.textContent = `$${mcap.toLocaleString()}`;
        }
        if (goldEl) {
          goldEl.textContent = "$14.2T (static est.)";
        }

        renderGlobalMiniDashboard(price);
        renderVaults(price);
      } catch (err) {
        console.error("Error loading BTC data:", err);
      }
    }

    // Initial load + periodic refresh
    loadBitcoinData();
    // Refresh every 60 seconds (optional)
    setInterval(loadBitcoinData, 60_000);
  </script>
</body>
</html>
